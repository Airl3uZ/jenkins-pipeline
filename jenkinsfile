@Library('SharedLibrary') _
pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                githubCheckout(
                    branch: 'origin/citest',
                    repo: 'demo-php-ci.git',
                    user: 'Airl3uZ',
                    path: 'data'
                )
            }
        }
        stage("Get Configuration") {
            steps {
                echo "Demo CI"
                script {
                    config = readYaml file: "data/ci/ciconfig.yml"
                    println config
                }
            }
        }
        stage("CheckoutCode") {
            when {
                expression {"${config.project.scm}" == 'github'}
            }
            steps {
                githubCheckout(
                    branch: "${config.project.branch}",
                    repo: "${config.project.repo}",
                    user: "${config.project.user}",
                    path: "${config.project.localPath}"
                )
            }
        }
        stage("Test") {
            steps {
                script {
                    for(String testStep: config.project.testStep {
                        println testStep
                    }
                }
            }
        }
    }
}