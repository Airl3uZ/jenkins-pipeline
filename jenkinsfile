@Library('SharedLibrary') _
pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                githubCheckout(
                    branch: 'origin/citest',
                    repo: 'demo-php-ci.git',
                    user: 'Airl3uZ',
                    path: 'data'
                )
            }
        }
        stage("Get Configuration") {
            steps {
                echo "Demo CI"
                script {
                    config = readYaml file: "data/ci/ciconfig.yml"
                    println config
                    project = config.project
                }
            }
        }
        stage("CheckoutCode") {
            when {
                expression {"${project.scm}" == 'github'}
            }
            steps {
                githubCheckout(
                    branch: "${project.branch}",
                    repo: "${project.repo}",
                    user: "${project.user}",
                    path: "${project.localPath}"
                )
            }
        }
        stage("Test") {
            steps {
                script {
                    for(String testStep: project.testStep) {
                        println testStep
                        load "${project.lang}-${testStep}.groovy"
                    }
                }
            }
        }
    }
}